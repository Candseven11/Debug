<!DOCTYPE html>
<html>
<head>
    <title>儿童头像转漫画</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="container">
        <h1>儿童头像转漫画</h1>
        <input type="file" id="upload" accept="image/*">
        <button id="generate">生成漫画风格</button>
        <div class="result">
            <img id="original" style="display:none;">
            <img id="result" style="display:none;">
        </div>
    </div>
    <script>
        document.getElementById('generate').addEventListener('click', async () => {
            const file = document.getElementById('upload').files[0];
            if (!file) return alert('请选择头像图片');
            
            const formData = new FormData();
            formData.append('image', file);
            
            const response = await fetch('/api/generate', {
                method: 'POST',
                body: formData
            });
            
            if (!response.ok) {
                const error = await response.json();
                console.error('API错误:', error);
                return alert('生成失败: ' + (error.error || '未知错误'));
            }
            
            const { resultImage } = await response.json();
            if (!resultImage) {
                return alert('未收到有效图片');
            }
            document.getElementById('original').src = URL.createObjectURL(file);
            document.getElementById('original').style.display = 'block';
            document.getElementById('result').src = resultImage;
            document.getElementById('result').style.display = 'block';
        });
    </script>
</body>
</html>